# vim:set ft=ruby:
module Autotest::Growl
  def self.growl(title, msg, img, pri=0, sticky="")
    system "growlnotify -n autotest --image #{img} -p #{pri} -m #{msg.inspect} #{title} #{sticky} 2>/dev/null"
  end

  def self.growl_light(color, msg)
    case color
    when :green
      growl 'Green', msg, "~/.autotest_images/pass.png"
    when :red
      growl 'Red', msg, "~/.autotest_images/fail.png", 2
    end
  end

  def self.results_summary(results)
    results.slice(/(\d+)\s+examples?,\s*(\d+)\s+failures?/)
  end

  Autotest.add_hook :green do |at|
    growl_light :green, results_summary(at.results)
  end

  Autotest.add_hook :red do |at|
    growl_light :red, results_summary(at.results)
  end
end

Autotest.add_hook :initialize do |at|
  %w[.hg .git vendor].each { |exception| at.add_exception(exception) }
end

Autotest.add_hook :initialize do |at|
  unless ARGV.empty?
    at.find_directories = ARGV.dup
  end
end

$VERBOSE = false
